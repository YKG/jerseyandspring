<!DOCTYPE html>
<html>
<head>
	<title>Place searches</title>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<meta charset="utf-8">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<link rel="stylesheet" href="/resources/demos/style.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script>

		// https://maps.googleapis.com/maps/api/geocode/json?address=The+San+Francisco+School,+San+Francisco,+CA&key=AIzaSyCJ1bvo4UjSrnxGsHJ0rYR4L6DpE9TsryM
		var map;
		var infowindow;

		function initMap() {
			var pyrmont = {lat: 37.757, lng: -122.472};

			map = new google.maps.Map(document.getElementById('map'), {
				center: pyrmont,
				zoom: 13
			});

			infowindow = new google.maps.InfoWindow();

			var service = new google.maps.places.PlacesService(map);
			service.nearbySearch({
				location: pyrmont,
				radius: 500,
				types: ['store']
			}, callback);
		}

		function callback(results, status) {
			//
			results = [];
			results.push({
				geometry: {
					location: {
						"lat" : 37.7326813,
						"lng" : -122.4113148
					}
				},
				name: "Americana",
				releaseYear: "2015"
			});
			console.log(results.length);

			if (status === google.maps.places.PlacesServiceStatus.OK) {
				for (var i = 0; i < results.length; i++) {
					createMarker(results[i]);
				}
			}
		}

		function createMarker(place) {
			var placeLoc = place.geometry.location;
			var marker = new google.maps.Marker({
				map: map,
				position: place.geometry.location
			});

			google.maps.event.addListener(marker, 'click', function() {
				infowindow.setContent(place.name + "<br>" + place.releaseYear);
				infowindow.open(map, this);
			});
		}


		$(function () {
			$("#name").autocomplete({
				minLength: 1,
				source: function(request, response) {
					$.ajax({
						url: 'http://localhost:8080/movie',
						data: {q: request.term},
						dataType: 'jsonp'
					}).done(function(data){
						var list = [];
						var arr = ['Boys', 'Bod', 'Aod', 'Some', 'ABC'];
						arr.forEach(function(element) {
							list.push({label: element, value: element});
							console.log({label: element, value: element});
						});

						response(list);
					}).fail(function (e) {
						console.log(e);
					});
				},
				select: function(event, ui) {
					Map.clearMarkers();
					showLocations("/search", ui.item.value);
				}
			});



			function showLocations(path, movie) {
				$.getJSON(path, {mid: movie}, function (results) {
					console.log(results);
					for (var i = 0; i < results.length; i++) {
						createMarker(results[i]);
					}
				})
			}
		});
	</script>
</head>
<body>

<div class="search-bar">
	<input type="text" id="name">
</div>

<div id="map"></div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCJ1bvo4UjSrnxGsHJ0rYR4L6DpE9TsryM&signed_in=true&libraries=places&callback=initMap" async defer></script>
</body>
</html>